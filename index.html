<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cloud Jumper Pro</title>
    <style>
        /* ... (keep all previous styles the same) ... */
    </style>
</head>
<body>
    <!-- ... (keep all previous HTML elements the same) ... -->

    <script>
        (function() {
            'use strict';
            
            const canvas = document.getElementById('gameCanvas');
            const ctx = canvas.getContext('2d');
            // ... (keep previous variable declarations) ...

            // Game state with corrected pipe spawning
            let gameState = {
                bird: {
                    x: 100,
                    y: 300,
                    velocity: 0,
                    gravity: 0.425,
                    jump: -8.5,
                    size: 22,
                    rotation: 0
                },
                pipes: [],
                clouds: [],
                score: 0,
                lastPipeSpawn: 0, // Initialize to 0
                pipeGap: 200,
                gameActive: true,
                lastFrameTime: 0
            };

            // Pipe class with guaranteed visibility
            class Pipe {
                constructor() {
                    this.x = canvas.width + 50; // Start fully off-screen right
                    this.gapY = Math.random() * (canvas.height - gameState.pipeGap - 150) + 75;
                    this.width = 50;
                    this.scored = false;
                }

                update() {
                    this.x -= 3; // Slightly faster movement
                }

                draw() {
                    // ... (keep previous pipe drawing code) ...
                }
            }

            // Game loop with guaranteed first pipe
            function update(currentTime) {
                if (!gameState.gameActive) return;

                // Initialize timing on first frame
                if (gameState.lastFrameTime === 0) {
                    gameState.lastFrameTime = currentTime;
                    gameState.lastPipeSpawn = currentTime - 1600; // Force immediate first pipe
                }

                const deltaTime = currentTime - gameState.lastFrameTime;
                gameState.lastFrameTime = currentTime;

                // ... (keep previous physics code) ...

                // Pipe spawning logic (fixed)
                if (currentTime - gameState.lastPipeSpawn > 1500) {
                    gameState.pipes.push(new Pipe());
                    gameState.lastPipeSpawn = currentTime;
                }

                // ... (keep rest of update code) ...
            }

            // Restart game with proper initialization
            window.restartGame = function() {
                gameState = {
                    bird: {
                        x: 100,
                        y: 300,
                        velocity: 0,
                        gravity: 0.425,
                        jump: -8.5,
                        size: 22,
                        rotation: 0
                    },
                    pipes: [],
                    clouds: [],
                    score: 0,
                    lastPipeSpawn: performance.now() - 1600, // Force immediate pipe
                    pipeGap: 200,
                    gameActive: true,
                    lastFrameTime: 0
                };
                // ... (keep rest of restart code) ...
            }

            // Start the game properly
            requestAnimationFrame((timestamp) => {
                gameState.lastFrameTime = timestamp;
                update(timestamp);
            });
        })();
    </script>
</body>
</html>
